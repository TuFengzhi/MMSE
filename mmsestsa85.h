//
// Created by Tu Fengzhi on 2018/9/30.
//

#ifndef MMSE_MMSESTSA85_H
#define MMSE_MMSESTSA85_H

#include <math.h>
#include <string.h>
#include <complex.h>
#include "fft.h"
#include "debugtools.h"

#define PI 3.14159265359
#define SAMPLE_RATE 16000
#define WINDOW_SIZE 512 // 0.032s ~ 32ms
#define HALF_WINDOW_SIZE 257
#define SHIFT_PERCERTAGE 0.625
#define SHIFT_SIZE 320 // 0.02s ~ 20ms
#define NIS 24         // NS=fix((IS*fs-W)/(SP*W) +1): Number of initial silence segments 0.5s

static const float Hamming_640[640] = {0.0800000000000000F, 0.0800222373154719F, 0.0800889471118956F, 0.0802001229395022F,
                                       0.0803557540493704F, 0.0805558253944649F, 0.0808003176310917F, 0.0810892071207684F,
                                       0.0814224659325091F, 0.0818000618455254F, 0.0822219583523415F, 0.0826881146623239F,
                                       0.0831984857056251F, 0.0837530221375411F, 0.0843516703432826F, 0.0849943724431580F,
                                       0.0856810662981704F, 0.0864116855160245F, 0.0871861594575463F, 0.0880044132435123F,
                                       0.0888663677618898F, 0.0897719396754850F, 0.0907210414300009F, 0.0917135812625021F,
                                       0.0927494632102869F, 0.0938285871201656F, 0.0949508486581432F, 0.0961161393195074F,
                                       0.0973243464393188F, 0.0985753532033040F, 0.0998690386591496F, 0.101205277728196F,
                                       0.102583941217533F, 0.104004895832485F, 0.105468004189505F, 0.106973124829453F,
                                       0.108520112231275F, 0.110108816826071F, 0.111739085011558F, 0.113410759166919F,
                                       0.115123677668041F, 0.116877674903148F, 0.118672581288804F, 0.120508223286316F,
                                       0.122384423418509F, 0.124301000286886F, 0.126257768589168F, 0.128254539137206F,
                                       0.130291118875276F, 0.132367310898743F, 0.134482914473097F, 0.136637725053365F,
                                       0.138831534303883F, 0.141064130118440F, 0.143335296640787F, 0.145644814285505F,
                                       0.147992459759234F, 0.150378006082266F, 0.152801222610488F, 0.155261875057679F,
                                       0.157759725518169F, 0.160294532489831F, 0.162866050897438F, 0.165474032116356F,
                                       0.168118223996579F, 0.170798370887112F, 0.173514213660686F, 0.176265489738810F,
                                       0.179051933117164F, 0.181873274391311F, 0.184729240782746F, 0.187619556165270F,
                                       0.190543941091689F, 0.193502112820827F, 0.196493785344868F, 0.199518669417004F,
                                       0.202576472579403F, 0.205666899191484F, 0.208789650458502F, 0.211944424460434F,
                                       0.215130916181173F, 0.218348817538016F, 0.221597817411451F, 0.224877601675240F,
                                       0.228187853226784F, 0.231528252017789F, 0.234898475085202F, 0.238298196582444F,
                                       0.241727087810907F, 0.245184817251740F, 0.248671050597898F, 0.252185450786465F,
                                       0.255727678031241F, 0.259297389855599F, 0.262894241125589F, 0.266517884083314F,
                                       0.270167968380551F, 0.273844141112621F, 0.277546046852511F, 0.281273327685241F,
                                       0.285025623242463F, 0.288802570737308F, 0.292603804999458F, 0.296428958510455F,
                                       0.300277661439232F, 0.304149541677871F, 0.308044224877579F, 0.311961334484883F,
                                       0.315900491778034F, 0.319861315903625F, 0.323843423913417F, 0.327846430801354F,
                                       0.331869949540800F, 0.335913591121947F, 0.339976964589431F, 0.344059677080134F,
                                       0.348161333861160F, 0.352281538368006F, 0.356419892242901F, 0.360575995373320F,
                                       0.364749445930671F, 0.368939840409140F, 0.373146773664712F, 0.377369838954334F,
                                       0.381608627975245F, 0.385862730904450F, 0.390131736438346F, 0.394415231832486F,
                                       0.398712802941485F, 0.403024034259062F, 0.407348508958215F, 0.411685808931517F,
                                       0.416035514831541F, 0.420397206111409F, 0.424770461065446F, 0.429154856869957F,
                                       0.433549969624105F, 0.437955374390893F, 0.442370645238255F, 0.446795355280231F,
                                       0.451229076718242F, 0.455671380882452F, 0.460121838273212F, 0.464580018602588F,
                                       0.469045490835961F, 0.473517823233701F, 0.477996583392910F, 0.482481338289230F,
                                       0.486971654318707F, 0.491467097339713F, 0.495967232714925F, 0.500471625353342F,
                                       0.504979839752355F, 0.509491440039852F, 0.514005990016360F, 0.518523053197217F,
                                       0.523042192854776F, 0.527562972060627F, 0.532084953727843F, 0.536607700653236F,
                                       0.541130775559633F, 0.545653741138148F, 0.550176160090466F, 0.554697595171122F,
                                       0.559217609229776F, 0.563735765253478F, 0.568251626408919F, 0.572764756084668F,
                                       0.577274717933386F, 0.581781075914008F, 0.586283394333909F, 0.590781237891024F,
                                       0.595274171715934F, 0.599761761413915F, 0.604243573106931F, 0.608719173475590F,
                                       0.613188129801033F, 0.617650010006776F, 0.622104382700479F, 0.626550817215663F,
                                       0.630988883653338F, 0.635418152923578F, 0.639838196786999F, 0.644248587896167F,
                                       0.648648899836915F, 0.653038707169571F, 0.657417585470088F, 0.661785111371083F,
                                       0.666140862602768F, 0.670484418033777F, 0.674815357711881F, 0.679133262904594F,
                                       0.683437716139656F, 0.687728301245394F, 0.692004603390963F, 0.696266209126451F,
                                       0.700512706422851F, 0.704743684711905F, 0.708958734925788F, 0.713157449536671F,
                                       0.717339422596111F, 0.721504249774309F, 0.725651528399194F, 0.729780857495363F,
                                       0.733891837822842F, 0.737984071915690F, 0.742057164120427F, 0.746110720634286F,
                                       0.750144349543289F, 0.754157660860138F, 0.758150266561920F, 0.762121780627625F,
                                       0.766071819075465F, 0.770000000000000F, 0.773905943609063F, 0.777789272260479F,
                                       0.781649610498577F, 0.785486585090492F, 0.789299825062246F, 0.793088961734622F,
                                       0.796853628758804F, 0.800593462151801F, 0.804308100331633F, 0.807997184152295F,
                                       0.811660356938482F, 0.815297264520067F, 0.818907555266348F, 0.822490880120047F,
                                       0.826046892631054F, 0.829575248989925F, 0.833075608061124F, 0.836547631416003F,
                                       0.839990983365525F, 0.843405330992716F, 0.846790344184859F, 0.850145695665405F,
                                       0.853471061025617F, 0.856766118755937F, 0.860030550277066F, 0.863264039970774F,
                                       0.866466275210405F, 0.869636946391110F, 0.872775746959781F, 0.875882373444684F,
                                       0.878956525484805F, 0.881997905858890F, 0.885006220514177F, 0.887981178594833F,
                                       0.890922492470068F, 0.893829877761950F, 0.896703053372896F, 0.899541741512852F,
                                       0.902345667726150F, 0.905114560918044F, 0.907848153380918F, 0.910546180820172F,
                                       0.913208382379775F, 0.915834500667483F, 0.918424281779728F, 0.920977475326164F,
                                       0.923493834453875F, 0.925973115871246F, 0.928415079871481F, 0.930819490355781F,
                                       0.933186114856169F, 0.935514724557969F, 0.937805094321927F, 0.940057002705977F,
                                       0.942270231986653F, 0.944444568180139F, 0.946579801062958F, 0.948675724192296F,
                                       0.950732134925961F, 0.952748834441979F, 0.954725627757814F, 0.956662323749220F,
                                       0.958558735168719F, 0.960414678663708F, 0.962229974794181F, 0.964004448050084F,
                                       0.965737926868279F, 0.967430243649135F, 0.969081234772728F, 0.970690740614666F,
                                       0.972258605561518F, 0.973784678025859F, 0.975268810460931F, 0.976710859374901F,
                                       0.978110685344740F, 0.979468153029704F, 0.980783131184411F, 0.982055492671541F,
                                       0.983285114474120F, 0.984471877707419F, 0.985615667630444F, 0.986716373657032F,
                                       0.987773889366545F, 0.988788112514153F, 0.989758945040727F, 0.990686293082312F,
                                       0.991570066979211F, 0.992410181284643F, 0.993206554773015F, 0.993959110447768F,
                                       0.994667775548823F, 0.995332481559618F, 0.995953164213731F, 0.996529763501091F,
                                       0.997062223673785F, 0.997550493251443F, 0.997994525026219F, 0.998394276067355F,
                                       0.998749707725328F, 0.999060785635591F, 0.999327479721893F, 0.999549764199188F,
                                       0.999727617576129F, 0.999861022657143F, 0.999949966544095F, 0.999994440637538F,
                                       0.999994440637538F, 0.999949966544095F, 0.999861022657143F, 0.999727617576129F,
                                       0.999549764199188F, 0.999327479721893F, 0.999060785635591F, 0.998749707725328F,
                                       0.998394276067355F, 0.997994525026219F, 0.997550493251443F, 0.997062223673785F,
                                       0.996529763501091F, 0.995953164213731F, 0.995332481559618F, 0.994667775548823F,
                                       0.993959110447768F, 0.993206554773015F, 0.992410181284643F, 0.991570066979211F,
                                       0.990686293082312F, 0.989758945040727F, 0.988788112514153F, 0.987773889366545F,
                                       0.986716373657032F, 0.985615667630444F, 0.984471877707419F, 0.983285114474120F,
                                       0.982055492671541F, 0.980783131184411F, 0.979468153029704F, 0.978110685344740F,
                                       0.976710859374901F, 0.975268810460931F, 0.973784678025859F, 0.972258605561518F,
                                       0.970690740614666F, 0.969081234772728F, 0.967430243649135F, 0.965737926868279F,
                                       0.964004448050084F, 0.962229974794181F, 0.960414678663708F, 0.958558735168719F,
                                       0.956662323749220F, 0.954725627757814F, 0.952748834441979F, 0.950732134925961F,
                                       0.948675724192296F, 0.946579801062958F, 0.944444568180139F, 0.942270231986653F,
                                       0.940057002705977F, 0.937805094321927F, 0.935514724557969F, 0.933186114856169F,
                                       0.930819490355781F, 0.928415079871481F, 0.925973115871246F, 0.923493834453875F,
                                       0.920977475326164F, 0.918424281779728F, 0.915834500667483F, 0.913208382379775F,
                                       0.910546180820172F, 0.907848153380918F, 0.905114560918044F, 0.902345667726150F,
                                       0.899541741512852F, 0.896703053372896F, 0.893829877761950F, 0.890922492470068F,
                                       0.887981178594833F, 0.885006220514177F, 0.881997905858890F, 0.878956525484805F,
                                       0.875882373444684F, 0.872775746959781F, 0.869636946391110F, 0.866466275210405F,
                                       0.863264039970774F, 0.860030550277066F, 0.856766118755937F, 0.853471061025617F,
                                       0.850145695665405F, 0.846790344184859F, 0.843405330992716F, 0.839990983365525F,
                                       0.836547631416003F, 0.833075608061124F, 0.829575248989925F, 0.826046892631054F,
                                       0.822490880120047F, 0.818907555266348F, 0.815297264520067F, 0.811660356938482F,
                                       0.807997184152295F, 0.804308100331633F, 0.800593462151801F, 0.796853628758804F,
                                       0.793088961734622F, 0.789299825062246F, 0.785486585090492F, 0.781649610498577F,
                                       0.777789272260479F, 0.773905943609063F, 0.770000000000000F, 0.766071819075465F,
                                       0.762121780627625F, 0.758150266561920F, 0.754157660860138F, 0.750144349543289F,
                                       0.746110720634286F, 0.742057164120427F, 0.737984071915690F, 0.733891837822842F,
                                       0.729780857495363F, 0.725651528399194F, 0.721504249774309F, 0.717339422596111F,
                                       0.713157449536671F, 0.708958734925788F, 0.704743684711905F, 0.700512706422851F,
                                       0.696266209126451F, 0.692004603390963F, 0.687728301245394F, 0.683437716139656F,
                                       0.679133262904594F, 0.674815357711881F, 0.670484418033777F, 0.666140862602768F,
                                       0.661785111371083F, 0.657417585470088F, 0.653038707169571F, 0.648648899836915F,
                                       0.644248587896167F, 0.639838196786999F, 0.635418152923578F, 0.630988883653338F,
                                       0.626550817215663F, 0.622104382700479F, 0.617650010006776F, 0.613188129801033F,
                                       0.608719173475590F, 0.604243573106931F, 0.599761761413915F, 0.595274171715934F,
                                       0.590781237891024F, 0.586283394333909F, 0.581781075914008F, 0.577274717933386F,
                                       0.572764756084668F, 0.568251626408919F, 0.563735765253478F, 0.559217609229776F,
                                       0.554697595171122F, 0.550176160090466F, 0.545653741138148F, 0.541130775559633F,
                                       0.536607700653236F, 0.532084953727843F, 0.527562972060627F, 0.523042192854776F,
                                       0.518523053197217F, 0.514005990016360F, 0.509491440039852F, 0.504979839752355F,
                                       0.500471625353342F, 0.495967232714925F, 0.491467097339713F, 0.486971654318707F,
                                       0.482481338289230F, 0.477996583392910F, 0.473517823233701F, 0.469045490835961F,
                                       0.464580018602588F, 0.460121838273212F, 0.455671380882452F, 0.451229076718242F,
                                       0.446795355280231F, 0.442370645238255F, 0.437955374390893F, 0.433549969624105F,
                                       0.429154856869957F, 0.424770461065446F, 0.420397206111409F, 0.416035514831541F,
                                       0.411685808931517F, 0.407348508958215F, 0.403024034259062F, 0.398712802941485F,
                                       0.394415231832486F, 0.390131736438346F, 0.385862730904450F, 0.381608627975245F,
                                       0.377369838954334F, 0.373146773664712F, 0.368939840409140F, 0.364749445930671F,
                                       0.360575995373320F, 0.356419892242901F, 0.352281538368006F, 0.348161333861160F,
                                       0.344059677080134F, 0.339976964589431F, 0.335913591121947F, 0.331869949540800F,
                                       0.327846430801354F, 0.323843423913417F, 0.319861315903625F, 0.315900491778034F,
                                       0.311961334484883F, 0.308044224877579F, 0.304149541677871F, 0.300277661439232F,
                                       0.296428958510455F, 0.292603804999458F, 0.288802570737308F, 0.285025623242463F,
                                       0.281273327685241F, 0.277546046852511F, 0.273844141112621F, 0.270167968380551F,
                                       0.266517884083314F, 0.262894241125589F, 0.259297389855599F, 0.255727678031241F,
                                       0.252185450786465F, 0.248671050597898F, 0.245184817251740F, 0.241727087810907F,
                                       0.238298196582444F, 0.234898475085202F, 0.231528252017789F, 0.228187853226784F,
                                       0.224877601675240F, 0.221597817411451F, 0.218348817538016F, 0.215130916181173F,
                                       0.211944424460434F, 0.208789650458502F, 0.205666899191484F, 0.202576472579403F,
                                       0.199518669417004F, 0.196493785344868F, 0.193502112820827F, 0.190543941091689F,
                                       0.187619556165270F, 0.184729240782746F, 0.181873274391311F, 0.179051933117164F,
                                       0.176265489738810F, 0.173514213660686F, 0.170798370887112F, 0.168118223996579F,
                                       0.165474032116356F, 0.162866050897438F, 0.160294532489831F, 0.157759725518169F,
                                       0.155261875057679F, 0.152801222610488F, 0.150378006082266F, 0.147992459759234F,
                                       0.145644814285505F, 0.143335296640787F, 0.141064130118440F, 0.138831534303883F,
                                       0.136637725053365F, 0.134482914473097F, 0.132367310898743F, 0.130291118875276F,
                                       0.128254539137206F, 0.126257768589168F, 0.124301000286886F, 0.122384423418509F,
                                       0.120508223286316F, 0.118672581288804F, 0.116877674903148F, 0.115123677668041F,
                                       0.113410759166919F, 0.111739085011558F, 0.110108816826071F, 0.108520112231275F,
                                       0.106973124829453F, 0.105468004189505F, 0.104004895832485F, 0.102583941217533F,
                                       0.101205277728196F, 0.0998690386591496F, 0.0985753532033040F, 0.0973243464393188F,
                                       0.0961161393195074F, 0.0949508486581432F, 0.0938285871201656F, 0.0927494632102869F,
                                       0.0917135812625021F, 0.0907210414300009F, 0.0897719396754850F, 0.0888663677618898F,
                                       0.0880044132435123F, 0.0871861594575463F, 0.0864116855160245F, 0.0856810662981704F,
                                       0.0849943724431580F, 0.0843516703432826F, 0.0837530221375411F, 0.0831984857056251F,
                                       0.0826881146623239F, 0.0822219583523415F, 0.0818000618455254F, 0.0814224659325091F,
                                       0.0810892071207684F, 0.0808003176310917F, 0.0805558253944649F, 0.0803557540493704F,
                                       0.0802001229395022F, 0.0800889471118956F, 0.0800222373154719F, 0.0800000000000000F};

int MMSESTSA85(float *Signal, float *OutputSignal);

#endif //MMSE_MMSESTSA85_H
